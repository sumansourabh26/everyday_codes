package httpServer;

import java.io.BufferedReader;
import java.io.DataOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.*;
import java.util.StringTokenizer;

public class Server {

	public static void main(String[] args) throws IOException {
		int port = 14999;
		
		ServerSocket socketServerSocket = new ServerSocket(port);
		
		while(true) {
			Socket socketClientSocket = socketServerSocket.accept();
			
			BufferedReader inputFromClient = new BufferedReader(new InputStreamReader(socketClientSocket.getInputStream()));
			DataOutputStream outputToClient = new DataOutputStream(socketClientSocket.getOutputStream());
			
			String messegeFromClient = inputFromClient.readLine();
			
			String[] tokensStrings = messegeFromClient.split(" ");
			
			if(tokensStrings[0].equals("GET")) {
				String requestedFilename = tokensStrings[1];
				if(requestedFilename.startsWith("/")) {
					requestedFilename = requestedFilename.substring(1);
					if(requestedFilename.startsWith("~")) {
						requestedFilename = "/home/users/"+requestedFilename.substring(1);
					}
				}
				File filetosend = new File(requestedFilename);
				int filesize = (int) filetosend.length();
				FileInputStream fileStream = null;
				boolean fileFound = true;
				try {
					fileStream = new FileInputStream(requestedFilename);					
				} catch (Exception e) {
					fileFound = false;
				}
				
				if(fileFound) {
					byte[] fileinByte =new byte[filesize];
					fileStream.read(fileinByte);
					outputToClient.writeBytes("HTTP/1.0 200 Document Follows\r\n\r\n");
					outputToClient.write(fileinByte, 0, filesize);
				}
				else {
					outputToClient.writeBytes("HTTP/1.0 404 Document NOT FOUND\r\n\r\n");
					outputToClient.writeBytes("404 document nahi hai be");
				}
			}
			socketClientSocket.close();
			
			
			
		}

	}

}
